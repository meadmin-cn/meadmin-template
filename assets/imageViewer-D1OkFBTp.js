import{d as S,m as J,r as z,ay as Ie,D as xe,p as w,C as U,y as ze,W as ee,o as C,w as c,k as n,$ as Ee,a as v,P as te,Q as i,u as t,X as E,c as R,L as B,ab as Ne,T as ae,j as le,t as Le,aa as Oe,ar as Re,R as Te,a0 as $e,z as Se,ac as se}from"./core-DgTHnQpx.js";import{i as ne,d as Ve,e as oe,m as Ae,f as De,g as Pe,h as Ye,j as Me,k as O,E as Xe,l as b,n as Be,t as F,o as N,p as Fe,w as je}from"./index-pAeQZ1-G.js";import{h as He,j as We,a as Ke,k as Ze,f as qe,z as Ge,n as Qe,r as Je,o as Ue}from"./elIcon-DHXrp9ew.js";import{E as et}from"./index-yTwIwyY4.js";import"./mock-h91I9qF-.js";const tt=Ve({urlList:{type:oe(Array),default:()=>Ae([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:oe(String)}}),at={close:()=>!0,switch:f=>ne(f),rotate:f=>ne(f)},st=S({name:"ElImageViewer"}),nt=S({...st,props:tt,emits:at,setup(f,{expose:k,emit:g}){var y;const o=f,I={CONTAIN:{name:"contain",icon:J(We)},ORIGINAL:{name:"original",icon:J(He)}};let V,j="";const{t:re}=Pe(),s=Ye("image-viewer"),{nextZIndex:ie}=Me(),A=z(),H=z([]),W=Ie(),x=z(!0),u=z(o.initialIndex),T=xe(I.CONTAIN),l=z({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ce=z((y=o.zIndex)!=null?y:ie()),ue=w(()=>{const{urlList:e}=o;return e.length<=1}),K=w(()=>u.value===0),Z=w(()=>u.value===o.urlList.length-1),de=w(()=>o.urlList[u.value]),fe=w(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!o.infinite&&K.value)]),me=w(()=>[s.e("btn"),s.e("next"),s.is("disabled",!o.infinite&&Z.value)]),pe=w(()=>{const{scale:e,deg:r,offsetX:a,offsetY:d,enableTransition:m}=l.value;let p=a/e,h=d/e;const L=r*Math.PI/180,G=Math.cos(L),Q=Math.sin(L);p=p*G+h*Q,h=h*G-a/e*Q;const X={transform:`scale(${e}) rotate(${r}deg) translate(${p}px, ${h}px)`,transition:m?"transform .3s":""};return T.value.name===I.CONTAIN.name&&(X.maxWidth=X.maxHeight="100%"),X}),ve=w(()=>`${u.value+1} / ${o.urlList.length}`);function $(){_e(),V==null||V(),document.body.style.overflow=j,g("close")}function ge(){const e=F(a=>{switch(a.code){case N.esc:o.closeOnPressEscape&&$();break;case N.space:D();break;case N.left:Y();break;case N.up:_("zoomIn");break;case N.right:M();break;case N.down:_("zoomOut");break}}),r=F(a=>{const d=a.deltaY||a.deltaX;_(d<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});W.run(()=>{O(document,"keydown",e),O(document,"wheel",r)})}function _e(){W.stop()}function he(){x.value=!1}function we(e){x.value=!1,e.target.alt=re("el.image.error")}function be(e){if(x.value||e.button!==0||!A.value)return;l.value.enableTransition=!1;const{offsetX:r,offsetY:a}=l.value,d=e.pageX,m=e.pageY,p=F(L=>{l.value={...l.value,offsetX:r+L.pageX-d,offsetY:a+L.pageY-m}}),h=O(document,"mousemove",p);O(document,"mouseup",()=>{h()}),e.preventDefault()}function q(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function D(){if(x.value)return;const e=Fe(I),r=Object.values(I),a=T.value.name,m=(r.findIndex(p=>p.name===a)+1)%e.length;T.value=I[e[m]],q()}function P(e){const r=o.urlList.length;u.value=(e+r)%r}function Y(){K.value&&!o.infinite||P(u.value-1)}function M(){Z.value&&!o.infinite||P(u.value+1)}function _(e,r={}){if(x.value)return;const{minScale:a,maxScale:d}=o,{zoomRate:m,rotateDeg:p,enableTransition:h}={zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0,...r};switch(e){case"zoomOut":l.value.scale>a&&(l.value.scale=Number.parseFloat((l.value.scale/m).toFixed(3)));break;case"zoomIn":l.value.scale<d&&(l.value.scale=Number.parseFloat((l.value.scale*m).toFixed(3)));break;case"clockwise":l.value.deg+=p,g("rotate",l.value.deg);break;case"anticlockwise":l.value.deg-=p,g("rotate",l.value.deg);break}l.value.enableTransition=h}function ke(e){var r;((r=e.detail)==null?void 0:r.focusReason)==="pointer"&&e.preventDefault()}function ye(){o.closeOnPressEscape&&$()}function Ce(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return U(de,()=>{Se(()=>{const e=H.value[0];e!=null&&e.complete||(x.value=!0)})}),U(u,e=>{q(),g("switch",e)}),ze(()=>{ge(),V=O("wheel",Ce,{passive:!1}),j=document.body.style.overflow,document.body.style.overflow="hidden"}),k({setActiveItem:P}),(e,r)=>(C(),ee(t(Be),{to:"body",disabled:!e.teleported},{default:c(()=>[n(Ee,{name:"viewer-fade",appear:""},{default:c(()=>[v("div",{ref_key:"wrapper",ref:A,tabindex:-1,class:i(t(s).e("wrapper")),style:te({zIndex:ce.value})},[n(t(Xe),{loop:"",trapped:"","focus-trap-el":A.value,"focus-start-el":"container",onFocusoutPrevented:ke,onReleaseRequested:ye},{default:c(()=>[v("div",{class:i(t(s).e("mask")),onClick:Ne(a=>e.hideOnClickModal&&$(),["self"])},null,10,["onClick"]),E(" CLOSE "),v("span",{class:i([t(s).e("btn"),t(s).e("close")]),onClick:$},[n(t(b),null,{default:c(()=>[n(t(Ke))]),_:1})],2),E(" ARROW "),t(ue)?E("v-if",!0):(C(),R(ae,{key:0},[v("span",{class:i(t(fe)),onClick:Y},[n(t(b),null,{default:c(()=>[n(t(Ze))]),_:1})],2),v("span",{class:i(t(me)),onClick:M},[n(t(b),null,{default:c(()=>[n(t(qe))]),_:1})],2)],64)),e.showProgress?(C(),R("div",{key:1,class:i([t(s).e("btn"),t(s).e("progress")])},[B(e.$slots,"progress",{activeIndex:u.value,total:e.urlList.length},()=>[le(Le(t(ve)),1)])],2)):E("v-if",!0),E(" ACTIONS "),v("div",{class:i([t(s).e("btn"),t(s).e("actions")])},[v("div",{class:i(t(s).e("actions__inner"))},[B(e.$slots,"toolbar",{actions:_,prev:Y,next:M,reset:D,activeIndex:u.value},()=>[n(t(b),{onClick:a=>_("zoomOut")},{default:c(()=>[n(t(Ge))]),_:1},8,["onClick"]),n(t(b),{onClick:a=>_("zoomIn")},{default:c(()=>[n(t(Qe))]),_:1},8,["onClick"]),v("i",{class:i(t(s).e("actions__divider"))},null,2),n(t(b),{onClick:D},{default:c(()=>[(C(),ee(Oe(t(T).icon)))]),_:1}),v("i",{class:i(t(s).e("actions__divider"))},null,2),n(t(b),{onClick:a=>_("anticlockwise")},{default:c(()=>[n(t(Je))]),_:1},8,["onClick"]),n(t(b),{onClick:a=>_("clockwise")},{default:c(()=>[n(t(Ue))]),_:1},8,["onClick"])])],2)],2),E(" CANVAS "),v("div",{class:i(t(s).e("canvas"))},[(C(!0),R(ae,null,Re(e.urlList,(a,d)=>Te((C(),R("img",{ref_for:!0,ref:m=>H.value[d]=m,key:a,src:a,style:te(t(pe)),class:i(t(s).e("img")),crossorigin:e.crossorigin,onLoad:he,onError:we,onMousedown:be},null,46,["src","crossorigin"])),[[$e,d===u.value]])),128))],2),B(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ot=De(nt,[["__file","image-viewer.vue"]]);const lt=je(ot);function rt(f){const k=document.createElement("div"),g=n(lt,Object.assign({teleported:!0,onClose:function(){se(null,k),typeof f.onClose=="function"&&f.onClose.call(this)}},f));return se(g,k),document.body.appendChild(k.firstElementChild),g}const it={class:"image-viewer"},ct=S({setup:!0,name:"ImageViewer"}),vt=S({...ct,__name:"imageViewer",setup(f){const k=()=>rt({urlList:["https://scpic.chinaz.net/Files/pic/pic6/pic1281.jpg","https://scpic.chinaz.net/files/pic/pic9/202009/apic27858.jpg","https://tse3-mm.cn.bing.net/th/id/OIP-C.n0_p3rYRuofABd3XudbZnAHaEo?pid=ImgDet&rs=1"]});return(g,y)=>{const o=et;return C(),R("div",it,[n(o,{onClick:y[0]||(y[0]=I=>k())},{default:c(()=>y[1]||(y[1]=[le(" 预览 ")])),_:1})])}}});export{vt as default};
