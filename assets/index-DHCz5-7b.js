import{E as w,a as H,i as B,g as F}from"./index-6UX7B9cc.js";import{E as p}from"./index-C673HT9H.js";import{h as Q,bs as S,aw as $,ao as D,Q as G,f as J,w as W}from"./index-pAeQZ1-G.js";import{U as x}from"./event-BB_Ol6Sd.js";import{C as A,p as C,a7 as z,z as E,d as I,l as X,s as U,I as Y,n as Z,r as R,a4 as L,y as ee,a5 as T}from"./core-DgTHnQpx.js";import{e as te}from"./strings-SjbtM2e1.js";const le=(e,{attrs:a,emit:o},{select:r,tree:s,key:n})=>{const h=Q("tree-select");return A(()=>e.data,()=>{e.filterable&&E(()=>{var t,v;(v=s.value)==null||v.filter((t=r.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...S(z(e),Object.keys(w.props)),...a,class:C(()=>a.class),style:C(()=>a.style),"onUpdate:modelValue":t=>o(x,t),valueKey:n,popperClass:C(()=>{const t=[h.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var v;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(v=s.value)==null||v.filter(t)}}},ce=I({extends:H,setup(e,a){const o=H.setup(e,a);delete o.selectOptionClick;const r=X().proxy;return E(()=>{o.select.states.cachedOptions.get(r.value)||o.select.onOptionCreate(r)}),A(()=>a.attrs.visible,s=>{E(()=>{o.states.visible=s})},{immediate:!0}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||e===0}function P(e){return U(e)&&e.length}function b(e){return U(e)?e:j(e)?[e]:[]}function O(e,a,o,r,s){for(let n=0;n<e.length;n++){const h=e[n];if(a(h,n,e,s))return r?r(h,n,e,s):h;{const k=o(h);if(P(k)){const t=O(k,a,o,r,h);if(t)return t}}}}function M(e,a,o,r){for(let s=0;s<e.length;s++){const n=e[s];a(n,s,e,r);const h=o(n);P(h)&&M(h,a,o,n)}}const ae=(e,{attrs:a,slots:o,emit:r},{select:s,tree:n,key:h})=>{A(()=>e.modelValue,()=>{e.showCheckbox&&E(()=>{const l=n.value;l&&!B(l.getCheckedKeys(),b(e.modelValue))&&l.setCheckedKeys(b(e.modelValue))})},{immediate:!0,deep:!0});const k=C(()=>({value:h.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var i;const u=k.value[l];return Y(u)?u(c,(i=n.value)==null?void 0:i.getNode(t("value",c))):c[u]},v=b(e.modelValue).map(l=>O(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,i,u,f)=>f&&t("value",f))).filter(l=>j(l)),_=C(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return M(e.data.concat(e.cacheData),c=>{const i=t("value",c);l.push({value:i,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l}),N=()=>{var l;return(l=n.value)==null?void 0:l.getCheckedKeys().filter(c=>{var i;const u=(i=n.value)==null?void 0:i.getNode(c);return!D(u)&&$(u.childNodes)})};return{...S(z(e),Object.keys(p.props)),...a,nodeKey:h,expandOnClickNode:C(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:C(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(l,{node:c,data:i,store:u})=>l(ce,{value:t("value",i),label:t("label",i),disabled:t("disabled",i),visible:c.visible},e.renderContent?()=>e.renderContent(l,{node:c,data:i,store:u}):o.default?()=>o.default({node:c,data:i,store:u}):void 0),filterNodeMethod:(l,c,i)=>e.filterNodeMethod?e.filterNodeMethod(l,c,i):l?new RegExp(te(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,i)=>{var u,f,m,K;if((u=a.onNodeClick)==null||u.call(a,l,c,i),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const g=(f=s.value)==null?void 0:f.states.options.get(t("value",l));(m=s.value)==null||m.handleOptionSelect(g)}}else e.expandOnClickNode&&i.proxy.handleExpandIconClick();(K=s.value)==null||K.focus()}},onCheck:(l,c)=>{var i;if(!e.showCheckbox)return;const u=t("value",l),f={};M([n.value.store.root],d=>f[d.key]=d,d=>d.childNodes);const m=c.checkedKeys,K=e.multiple?b(e.modelValue).filter(d=>!(d in f)&&!m.includes(d)):[],g=K.concat(m);if(e.checkStrictly)r(x,e.multiple?g:g.includes(u)?u:void 0);else if(e.multiple){const d=N();r(x,K.concat(d))}else{const d=O([l],y=>!P(t("children",y))&&!t("disabled",y),y=>t("children",y)),V=d?t("value",d):void 0,q=j(e.modelValue)&&!!O([l],y=>t("value",y)===e.modelValue,y=>t("children",y));r(x,V===e.modelValue||q?void 0:V)}E(()=>{var d;const V=b(e.modelValue);n.value.setCheckedKeys(V),(d=a.onCheck)==null||d.call(a,l,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})}),(i=s.value)==null||i.focus()},onNodeExpand:(l,c,i)=>{var u;(u=a.onNodeExpand)==null||u.call(a,l,c,i),E(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&c.checked){const f={},m=n.value.getCheckedKeys();M([n.value.store.root],d=>f[d.key]=d,d=>d.childNodes);const K=b(e.modelValue).filter(d=>!(d in f)&&!m.includes(d)),g=N();r(x,K.concat(g))}})},cacheOptions:_}};var ne=I({props:{data:{type:Array,default:()=>[]}},setup(e){const a=Z(F);return A(()=>e.data,()=>{var o;e.data.forEach(s=>{a.states.cachedOptions.has(s.value)||a.states.cachedOptions.set(s.value,s)});const r=((o=a.selectRef)==null?void 0:o.querySelectorAll("input"))||[];G&&!Array.from(r).includes(document.activeElement)&&a.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const se=I({name:"ElTreeSelect",inheritAttrs:!1,props:{...w.props,...p.props,cacheData:{type:Array,default:()=>[]}},setup(e,a){const{slots:o,expose:r}=a,s=R(),n=R(),h=C(()=>e.nodeKey||e.valueKey||"value"),k=le(e,a,{select:s,tree:n,key:h}),{cacheOptions:t,...v}=ae(e,a,{select:s,tree:n,key:h}),_=L({});return r(_),ee(()=>{Object.assign(_,{...S(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...S(s.value,["focus","blur","selectedLabel"])})}),()=>T(w,L({...k,ref:N=>s.value=N}),{...o,default:()=>[T(ne,{data:t.value}),T(p,L({...v,ref:N=>n.value=N}))]})}});var ie=J(se,[["__file","tree-select.vue"]]);const ve=W(ie);export{ve as E};
